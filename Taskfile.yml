# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: "3"

tasks:
  clean-logs:
    internal: true
    cmds:
      - truncate -s0 debug.log
      - truncate -s0 collector.log

  run:
    desc: Run the application
    deps:
      - clean-logs
    interactive: true
    cmds:
      - go build -o otelly ./cmd/app/main.go
      - ./otelly

  debug:
    desc: Builds and runs the app to be debugged
    deps:
      - clean-logs
    interactive: true
    cmds:
      - go build -gcflags="all=-N -l" -o otelly ./cmd/app/main.go
      - ./otelly

  ingest-dummy-data:
    desc: Use antithesishq/otel-datagen to ingest dummy data
    cmd: |
      otelgen --otel-exporter-otlp-endpoint localhost:4317 --insecure --rate 1 --duration 30 -s microservice traces multi
